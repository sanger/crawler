from typing import List

from crawler.config.centres import (
    BIOMEK_LABWARE_CLASS_KINGFISHER,
    CENTRE_DATA_SOURCE_RABBITMQ,
    CENTRE_DATA_SOURCE_SFTP,
    CENTRE_REGEX_BARCODE,
    CENTRE_REGEX_SFTP_FILE_HERON,
    REGEX_SURVEILLANCE_GLS_1,
    REGEX_SURVEILLANCE_GLS_2,
)
from crawler.constants import (
    BIOMEK_LABWARE_CLASS_BIO,
    CENTRE_KEY_BACKUPS_FOLDER,
    CENTRE_KEY_BARCODE_FIELD,
    CENTRE_KEY_BARCODE_REGEX,
    CENTRE_KEY_BIOMEK_LABWARE_CLASS,
    CENTRE_KEY_DATA_SOURCE,
    CENTRE_KEY_FEEDBACK_ROUTING_KEY_PREFIX,
    CENTRE_KEY_FILE_NAMES_TO_IGNORE,
    CENTRE_KEY_FILE_REGEX_CONSOLIDATED_EAGLE,
    CENTRE_KEY_FILE_REGEX_CONSOLIDATED_SURVEILLANCE,
    CENTRE_KEY_FILE_REGEX_UNCONSOLIDATED_SURVEILLANCE,
    CENTRE_KEY_INCLUDE_IN_SCHEDULED_RUNS,
    CENTRE_KEY_LAB_ID_DEFAULT,
    CENTRE_KEY_NAME,
    CENTRE_KEY_PREFIX,
    CENTRE_KEY_SFTP_ROOT_READ,
    CENTRE_KEY_SKIP_UNCONSOLIDATED_SURVEILLANCE_FILES,
    FIELD_RNA_ID,
    TEST_DATA_CENTRE_LAB_ID,
    TEST_DATA_CENTRE_PREFIX,
)
from crawler.types import CentreConf

CENTRE_DIR_BACKUPS = "tmp/backups"

# Use a known centre config with an extra centre for testing
CENTRES: List[CentreConf] = [
    {
        CENTRE_KEY_BACKUPS_FOLDER: f"{CENTRE_DIR_BACKUPS}/ALDP",
        CENTRE_KEY_BARCODE_FIELD: FIELD_RNA_ID,
        CENTRE_KEY_BARCODE_REGEX: CENTRE_REGEX_BARCODE,
        CENTRE_KEY_BIOMEK_LABWARE_CLASS: BIOMEK_LABWARE_CLASS_KINGFISHER,
        CENTRE_KEY_DATA_SOURCE: CENTRE_DATA_SOURCE_SFTP,
        CENTRE_KEY_FILE_NAMES_TO_IGNORE: [],
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_EAGLE: r"^APE\d+\.csv$",
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_SURVEILLANCE: r"^[a-zA-Z]{2}-[a-zA-Z]{3}-\d+\.csv$",
        CENTRE_KEY_FILE_REGEX_UNCONSOLIDATED_SURVEILLANCE: f"^AP_{CENTRE_REGEX_SFTP_FILE_HERON}",
        CENTRE_KEY_INCLUDE_IN_SCHEDULED_RUNS: True,
        CENTRE_KEY_LAB_ID_DEFAULT: "AP",
        CENTRE_KEY_NAME: "Alderley",
        CENTRE_KEY_PREFIX: "ALDP",
        CENTRE_KEY_SFTP_ROOT_READ: "project-heron_alderly-park",
        CENTRE_KEY_SKIP_UNCONSOLIDATED_SURVEILLANCE_FILES: True,
    },
    {
        CENTRE_KEY_BACKUPS_FOLDER: f"{CENTRE_DIR_BACKUPS}/MILK",
        CENTRE_KEY_BARCODE_FIELD: FIELD_RNA_ID,
        CENTRE_KEY_BARCODE_REGEX: CENTRE_REGEX_BARCODE,
        CENTRE_KEY_BIOMEK_LABWARE_CLASS: BIOMEK_LABWARE_CLASS_KINGFISHER,
        CENTRE_KEY_DATA_SOURCE: CENTRE_DATA_SOURCE_SFTP,
        CENTRE_KEY_FILE_NAMES_TO_IGNORE: ["MK_sanger_report_200715_2000_master.csv"],
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_EAGLE: r"^(EGL|EMK)\d+\.csv$",
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_SURVEILLANCE: r"^(cp)?RNA\d+\.csv$",
        CENTRE_KEY_FILE_REGEX_UNCONSOLIDATED_SURVEILLANCE: f"^MK_{CENTRE_REGEX_SFTP_FILE_HERON}",
        CENTRE_KEY_INCLUDE_IN_SCHEDULED_RUNS: True,
        CENTRE_KEY_LAB_ID_DEFAULT: "MK",
        CENTRE_KEY_NAME: "UK Biocentre",
        CENTRE_KEY_PREFIX: "MILK",
        CENTRE_KEY_SFTP_ROOT_READ: "project-heron/UK-Biocenter/Sanger Reports",
        CENTRE_KEY_SKIP_UNCONSOLIDATED_SURVEILLANCE_FILES: True,
    },
    {
        CENTRE_KEY_BACKUPS_FOLDER: f"{CENTRE_DIR_BACKUPS}/QEUH",
        CENTRE_KEY_BARCODE_FIELD: FIELD_RNA_ID,
        CENTRE_KEY_BARCODE_REGEX: CENTRE_REGEX_BARCODE,
        CENTRE_KEY_BIOMEK_LABWARE_CLASS: BIOMEK_LABWARE_CLASS_KINGFISHER,
        CENTRE_KEY_DATA_SOURCE: CENTRE_DATA_SOURCE_RABBITMQ,
        CENTRE_KEY_FILE_NAMES_TO_IGNORE: ["GLS_sanger_report_200713_0001_master.csv"],
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_EAGLE: r"^(EGG|GLS)\d+\.csv$",
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_SURVEILLANCE: f"({REGEX_SURVEILLANCE_GLS_1}|{REGEX_SURVEILLANCE_GLS_2})",
        CENTRE_KEY_FILE_REGEX_UNCONSOLIDATED_SURVEILLANCE: f"^GLS_{CENTRE_REGEX_SFTP_FILE_HERON}",
        CENTRE_KEY_INCLUDE_IN_SCHEDULED_RUNS: True,
        CENTRE_KEY_LAB_ID_DEFAULT: "GLS",
        CENTRE_KEY_NAME: "Queen Elizabeth University Hospital",
        CENTRE_KEY_PREFIX: "QEUH",
        CENTRE_KEY_SFTP_ROOT_READ: "project-heron_glasgow",
        CENTRE_KEY_SKIP_UNCONSOLIDATED_SURVEILLANCE_FILES: True,
    },
    {
        CENTRE_KEY_BACKUPS_FOLDER: f"{CENTRE_DIR_BACKUPS}/CAMC",
        CENTRE_KEY_BARCODE_FIELD: FIELD_RNA_ID,
        CENTRE_KEY_BARCODE_REGEX: CENTRE_REGEX_BARCODE,
        CENTRE_KEY_BIOMEK_LABWARE_CLASS: BIOMEK_LABWARE_CLASS_BIO,
        CENTRE_KEY_DATA_SOURCE: CENTRE_DATA_SOURCE_SFTP,
        CENTRE_KEY_FILE_NAMES_TO_IGNORE: ["CB_sanger_report_200714_0001_master.csv"],
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_EAGLE: r"^(EGC|CBE)\d+\.csv$",
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_SURVEILLANCE: r"^\d{9}\.csv$",
        CENTRE_KEY_FILE_REGEX_UNCONSOLIDATED_SURVEILLANCE: f"^CB_{CENTRE_REGEX_SFTP_FILE_HERON}",
        CENTRE_KEY_INCLUDE_IN_SCHEDULED_RUNS: True,
        CENTRE_KEY_LAB_ID_DEFAULT: "CB",
        CENTRE_KEY_NAME: "Cambridge-az",
        CENTRE_KEY_PREFIX: "CAMC",
        CENTRE_KEY_SFTP_ROOT_READ: "project-heron_cambridge-az",
        CENTRE_KEY_SKIP_UNCONSOLIDATED_SURVEILLANCE_FILES: False,
    },
    {
        CENTRE_KEY_BACKUPS_FOLDER: f"{CENTRE_DIR_BACKUPS}/RAND",
        CENTRE_KEY_BARCODE_FIELD: FIELD_RNA_ID,
        CENTRE_KEY_BARCODE_REGEX: CENTRE_REGEX_BARCODE,
        CENTRE_KEY_BIOMEK_LABWARE_CLASS: BIOMEK_LABWARE_CLASS_KINGFISHER,
        CENTRE_KEY_DATA_SOURCE: CENTRE_DATA_SOURCE_SFTP,
        CENTRE_KEY_FILE_NAMES_TO_IGNORE: [r"^lw-randox-biocentre-box-((\d)|(1\d)|20)-.*$"],
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_EAGLE: r"^RXE\d+\.csv$",
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_SURVEILLANCE: r"^RDX-[a-zA-Z0-9]{2}-\d+\.csv$",
        CENTRE_KEY_FILE_REGEX_UNCONSOLIDATED_SURVEILLANCE: r"^lw-randox-biocentre-box-.*\.csv$",
        CENTRE_KEY_INCLUDE_IN_SCHEDULED_RUNS: True,
        CENTRE_KEY_LAB_ID_DEFAULT: "Randox",
        CENTRE_KEY_NAME: "Randox",
        CENTRE_KEY_PREFIX: "RAND",
        CENTRE_KEY_SFTP_ROOT_READ: "project-heron_randox",
        CENTRE_KEY_SKIP_UNCONSOLIDATED_SURVEILLANCE_FILES: False,
    },
    {
        CENTRE_KEY_BACKUPS_FOLDER: f"{CENTRE_DIR_BACKUPS}/HSL",
        CENTRE_KEY_BARCODE_FIELD: FIELD_RNA_ID,
        CENTRE_KEY_BARCODE_REGEX: CENTRE_REGEX_BARCODE,
        CENTRE_KEY_BIOMEK_LABWARE_CLASS: BIOMEK_LABWARE_CLASS_KINGFISHER,
        CENTRE_KEY_DATA_SOURCE: CENTRE_DATA_SOURCE_SFTP,
        CENTRE_KEY_FILE_NAMES_TO_IGNORE: [],
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_EAGLE: r"^$",
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_SURVEILLANCE: r"^HSL\d+\.csv$",
        CENTRE_KEY_FILE_REGEX_UNCONSOLIDATED_SURVEILLANCE: r"^$",
        CENTRE_KEY_INCLUDE_IN_SCHEDULED_RUNS: True,
        CENTRE_KEY_LAB_ID_DEFAULT: "HSLL",
        CENTRE_KEY_NAME: "Health Services Laboratories",
        CENTRE_KEY_PREFIX: "HSLL",
        CENTRE_KEY_SFTP_ROOT_READ: "project-heron_hsl",
        CENTRE_KEY_SKIP_UNCONSOLIDATED_SURVEILLANCE_FILES: False,
    },
    {
        CENTRE_KEY_BACKUPS_FOLDER: f"{CENTRE_DIR_BACKUPS}/PLYM",
        CENTRE_KEY_BARCODE_FIELD: FIELD_RNA_ID,
        CENTRE_KEY_BARCODE_REGEX: CENTRE_REGEX_BARCODE,
        CENTRE_KEY_BIOMEK_LABWARE_CLASS: BIOMEK_LABWARE_CLASS_KINGFISHER,
        CENTRE_KEY_DATA_SOURCE: CENTRE_DATA_SOURCE_RABBITMQ,
        CENTRE_KEY_FILE_NAMES_TO_IGNORE: [],
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_EAGLE: r"^$",
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_SURVEILLANCE: r"^PLY-chp-\d+\.csv$",
        CENTRE_KEY_FILE_REGEX_UNCONSOLIDATED_SURVEILLANCE: f"^PLYM_{CENTRE_REGEX_SFTP_FILE_HERON}",
        CENTRE_KEY_INCLUDE_IN_SCHEDULED_RUNS: True,
        CENTRE_KEY_LAB_ID_DEFAULT: "PLYM",
        CENTRE_KEY_NAME: "Plymouth",
        CENTRE_KEY_PREFIX: "PLYM",
        CENTRE_KEY_SFTP_ROOT_READ: "project-heron_plym",
        CENTRE_KEY_SKIP_UNCONSOLIDATED_SURVEILLANCE_FILES: False,
    },
    {
        CENTRE_KEY_BACKUPS_FOLDER: f"{CENTRE_DIR_BACKUPS}/BRBR",
        CENTRE_KEY_BARCODE_FIELD: FIELD_RNA_ID,
        CENTRE_KEY_BARCODE_REGEX: CENTRE_REGEX_BARCODE,
        CENTRE_KEY_BIOMEK_LABWARE_CLASS: BIOMEK_LABWARE_CLASS_KINGFISHER,
        CENTRE_KEY_DATA_SOURCE: CENTRE_DATA_SOURCE_SFTP,
        CENTRE_KEY_FILE_NAMES_TO_IGNORE: [],
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_EAGLE: r"^$",
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_SURVEILLANCE: r"^BB[-_]\d+\.csv$",
        CENTRE_KEY_FILE_REGEX_UNCONSOLIDATED_SURVEILLANCE: r"^$",
        CENTRE_KEY_INCLUDE_IN_SCHEDULED_RUNS: True,
        CENTRE_KEY_LAB_ID_DEFAULT: "BRBR",
        CENTRE_KEY_NAME: "Brants Bridge",
        CENTRE_KEY_PREFIX: "BRBR",
        CENTRE_KEY_SFTP_ROOT_READ: "project-heron_brbr",
        CENTRE_KEY_SKIP_UNCONSOLIDATED_SURVEILLANCE_FILES: False,
    },
    {
        CENTRE_KEY_BACKUPS_FOLDER: f"{CENTRE_DIR_BACKUPS}/LSPA",
        CENTRE_KEY_BARCODE_FIELD: FIELD_RNA_ID,
        CENTRE_KEY_BARCODE_REGEX: CENTRE_REGEX_BARCODE,
        CENTRE_KEY_BIOMEK_LABWARE_CLASS: BIOMEK_LABWARE_CLASS_KINGFISHER,
        CENTRE_KEY_DATA_SOURCE: CENTRE_DATA_SOURCE_RABBITMQ,
        CENTRE_KEY_FILE_NAMES_TO_IGNORE: [],
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_EAGLE: r"^$",
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_SURVEILLANCE: r"^LML_CHERY\d+\.csv$",
        CENTRE_KEY_FILE_REGEX_UNCONSOLIDATED_SURVEILLANCE: r"^$",
        CENTRE_KEY_INCLUDE_IN_SCHEDULED_RUNS: True,
        CENTRE_KEY_LAB_ID_DEFAULT: "LML",
        CENTRE_KEY_NAME: "Leamington Spa",
        CENTRE_KEY_PREFIX: "LSPA",
        CENTRE_KEY_SFTP_ROOT_READ: "project-heron_lspa",
        CENTRE_KEY_SKIP_UNCONSOLIDATED_SURVEILLANCE_FILES: False,
    },
    {
        CENTRE_KEY_BACKUPS_FOLDER: f"{CENTRE_DIR_BACKUPS}/NEWC",
        CENTRE_KEY_BARCODE_FIELD: FIELD_RNA_ID,
        CENTRE_KEY_BARCODE_REGEX: CENTRE_REGEX_BARCODE,
        CENTRE_KEY_BIOMEK_LABWARE_CLASS: BIOMEK_LABWARE_CLASS_KINGFISHER,
        CENTRE_KEY_DATA_SOURCE: CENTRE_DATA_SOURCE_SFTP,
        CENTRE_KEY_FILE_NAMES_TO_IGNORE: [],
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_EAGLE: r"^$",
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_SURVEILLANCE: r"^ICHNE\d+[A-Z|a-z]{1}\.csv$",
        CENTRE_KEY_FILE_REGEX_UNCONSOLIDATED_SURVEILLANCE: r"^$",
        CENTRE_KEY_INCLUDE_IN_SCHEDULED_RUNS: True,
        CENTRE_KEY_LAB_ID_DEFAULT: "NCL",
        CENTRE_KEY_NAME: "Newcastle",
        CENTRE_KEY_PREFIX: "NEWC",
        CENTRE_KEY_SFTP_ROOT_READ: "project-heron_newc",
        CENTRE_KEY_SKIP_UNCONSOLIDATED_SURVEILLANCE_FILES: False,
    },
    {
        CENTRE_KEY_BACKUPS_FOLDER: f"{CENTRE_DIR_BACKUPS}/CPTD",
        CENTRE_KEY_BARCODE_FIELD: FIELD_RNA_ID,
        CENTRE_KEY_BARCODE_REGEX: CENTRE_REGEX_BARCODE,
        CENTRE_KEY_BIOMEK_LABWARE_CLASS: BIOMEK_LABWARE_CLASS_KINGFISHER,
        CENTRE_KEY_DATA_SOURCE: CENTRE_DATA_SOURCE_RABBITMQ,
        CENTRE_KEY_FEEDBACK_ROUTING_KEY_PREFIX: "cptd.",
        CENTRE_KEY_FILE_NAMES_TO_IGNORE: [],
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_EAGLE: r"^$",
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_SURVEILLANCE: r"^$",
        CENTRE_KEY_FILE_REGEX_UNCONSOLIDATED_SURVEILLANCE: r"^CPTD_\d{6}_\d{6}_\d{6}\.csv$",
        CENTRE_KEY_INCLUDE_IN_SCHEDULED_RUNS: False,
        CENTRE_KEY_LAB_ID_DEFAULT: TEST_DATA_CENTRE_LAB_ID,
        CENTRE_KEY_NAME: "Cherrypick Test Data",
        CENTRE_KEY_PREFIX: TEST_DATA_CENTRE_PREFIX,
        CENTRE_KEY_SFTP_ROOT_READ: "",
        CENTRE_KEY_SKIP_UNCONSOLIDATED_SURVEILLANCE_FILES: False,
    },
    {
        CENTRE_KEY_BACKUPS_FOLDER: "tmp/backups/TEST",
        CENTRE_KEY_BARCODE_FIELD: FIELD_RNA_ID,
        CENTRE_KEY_BARCODE_REGEX: CENTRE_REGEX_BARCODE,
        CENTRE_KEY_BIOMEK_LABWARE_CLASS: BIOMEK_LABWARE_CLASS_KINGFISHER,
        CENTRE_KEY_DATA_SOURCE: CENTRE_DATA_SOURCE_SFTP,
        CENTRE_KEY_FILE_NAMES_TO_IGNORE: ["TEST_sanger_report_200518_2205.csv"],
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_EAGLE: r"^TE\d+\.csv$",
        CENTRE_KEY_FILE_REGEX_CONSOLIDATED_SURVEILLANCE: r"^Test-\d+\.csv$",
        CENTRE_KEY_FILE_REGEX_UNCONSOLIDATED_SURVEILLANCE: f"^TEST_{CENTRE_REGEX_SFTP_FILE_HERON}",
        CENTRE_KEY_INCLUDE_IN_SCHEDULED_RUNS: True,
        CENTRE_KEY_LAB_ID_DEFAULT: "TE",
        CENTRE_KEY_NAME: "Test Centre",
        CENTRE_KEY_PREFIX: "TEST",
        CENTRE_KEY_SFTP_ROOT_READ: "tests/test_files/good",
        CENTRE_KEY_SKIP_UNCONSOLIDATED_SURVEILLANCE_FILES: False,
    },
]
